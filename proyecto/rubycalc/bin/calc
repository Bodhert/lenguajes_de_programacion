#!/usr/bin/env ruby

require 'rubygems'
require 'calculator'
require 'calcex'

$stdout.print "> "
$stdout.flush

$calc = Calculator.new()

$calc.enviroment

preference = false 

for i in 0..ARGV.length 
  if ARGV[i] == "-e"
    preference = true
  elsif ARGV[i] == "-v"
    i = i + 1
    var = ARGV[i]
    if preference
      variable = $calc.splitVar(var)
      integer = $calc.splitInt(var)
      unless $calc.search1(variable)
        $calc.assign(variable,integer)
      end
    else
      variable = $calc.splitVar(var)
      integer = $calc.splitInt(var)
      $calc.assign(variable,integer)
    end
  end
end

text = $stdin.gets

begin
  puts "= " + $calc.eval(text).to_s
rescue ParseError
  puts "Parse Error"
rescue UnrecognizedTokenException
  puts "UnrecognizedTokenException"
rescue
  puts "Unkown exception"
end
